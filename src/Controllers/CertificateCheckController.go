package controllers

import (
	"../Helpers/X509"
	"crypto/x509"
	"fmt"
	"log"
	"net/http"
	"strconv"
	"time"
)

const trustStore = `
Some bullshit here

-----BEGIN CERTIFICATE-----
MIIGczCCBFugAwIBAgIRAJhvtpVWCRY4LJXEFrWyGXMwDQYJKoZIhvcNAQELBQAw
gYcxCzAJBgNVBAYTAk5MMTcwNQYDVQQKEy5NaW5pc3RlcmllIHZhbiBPbmRlcndp
anMgQ3VsdHV1ciBlbiBXZXRlbnNjaGFwMT8wPQYDVQQDEzZNaW5pc3RlcmllIHZh
biBPbmRlcndpanMgQ3VsdHV1ciBlbiBXZXRlbnNjaGFwIFJvb3QgQ0EwHhcNMTUx
MTIzMTAwMzE0WhcNMjUxMTIyMDk1MzE1WjBcMQswCQYDVQQGEwJOTDEkMCIGA1UE
ChMbRGllbnN0IFVpdHZvZXJpbmcgT25kZXJ3aWpzMScwJQYDVQQDEx5EaWVuc3Qg
VWl0dm9lcmluZyBPbmRlcndpanMgQ0EwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAw
ggIKAoICAQDclzSC2bLaf6q9pq5EOtdtJiGwBzw6CG+DrNBFeixR1/REzsId9RB4
X01Vwu8a7/QOzR82Z0/h3Bg0mBlHklneoHUAnOpLpYP9mNuLMYlEIJqxuo1n6IET
vGvVn8Y3DFUj7ODXrzDF4qzTbhVGtt8TsY6qYEYIU2hQegsjb3lcaP18yMKrro2+
CBIJFQXBPwrYXW0Tx4Vo5b/Guek2ttuyJaFZqsDtQDPX0PxU1Qx3Uqni7ucV2UdU
VRmQ0E9smeea+oyOZLPRgHXzbsBE7TLJ9oHB0AQQO7mguC4gr9gLqNNRZUisTp3k
4pxlm/QFD1q3EgxQKid0rHgX+caKHKZkot35rpIee7yD2ODWFRncBj4+SJ/tKkqn
qvT9Lzg9QAvUTRUnK228G/mY8tF23ChXHfMe/lD5GPzGiYaRp9Q6lh6GJxWhTLkw
MIAQy2Me5l9I1nxH2MyIdGut1wSAThc9Vt3i0CDrGOD9+cWI08fGnuhmjL1+XXHb
+FJbR/jTPSdmEbgT/QzPq4Vcl/RQCtrJJAR0uHzEef5q5317gXL2rLMzpNy1a/pu
ZtkCRzdCzJheQ6Wlg34TznTEDdFve697XVzXxtx1om6YhZIztOjhUNah7Kzlvb5H
NiUkgE+KFE8j1Q2dy8kQdR5yx41JS2k1VyBuDIsAJhLAPQybXKPUGQIDAQABo4IB
AjCB/zAOBgNVHQ8BAf8EBAMCAQYwHwYDVR0jBBgwFoAUL1IgdIWBjAKs9pF1fQ+Q
mi6s/bgwDwYDVR0TAQH/BAUwAwEB/zA7BgNVHSAENDAyMDAGBFUdIAAwKDAmBggr
BgEFBQcCARYaaHR0cDovL3pha2VsaWprLmR1by5ubC9jcHMwHQYDVR0OBBYEFLV3
0esHIvNQVFrG8tSZF+wHkP+EMF8GA1UdHwRYMFYwVKBSoFCGTmh0dHA6Ly96YWtl
bGlqay5kdW8ubmwvY3JsL01pbmlzdGVyaWV2YW5PbmRlcndpanNDdWx0dXVyZW5X
ZXRlbnNjaGFwUm9vdENBLmNybDANBgkqhkiG9w0BAQsFAAOCAgEAEvT9FJHQ173P
MdVPcCYxURD9fSnuU/8hyoPb6P/ZycC/oA4WQqCqS/mQ8q8ORdyFimYNmGHo3Yb4
j3I5rnCkuV+NOeX96epg7IJMXuZ7Iw4HSPV7XLeHpFp0UqDVfC6Xa1rKQbfjkBuu
5wqEC/HRLoQQHR3uQTerq1VivhqcS4XA1h2HxTufx7gGZxiOKgi+kUFVhv2R3dkw
Jjj0GVIT5HMBcz/VzA/mBTIsKonnaahF50/+sFbkXYRTT7n8jprVGNACGPQVAqqI
Hg14PhK7X8M1mCM2vSxcU9qm1SfoM/ipN4I+kUVtIXnQF1sdwxt1l37hyWtHTFnt
mn1b9HAdY22EaVD0VDuN9Lk/nGCQjrw8uQ138n9+/Vu6q4gWxg5i1v5CWBUgLyyr
9W9EGgXcHuebNCQS5U34wdt4zp4rLtuekckJDPv+l3JQzpT/JLondHea1N8dBDmN
OwnnV9HLRhqb4Nw3PONLZs2SdeUUh1D5CGOqZuHqzc4/yRFBVxI2dXRhvFuOtU7S
A1xBIBskeMViGmXFL0bBVLtG6aw8Yrk/KBDzdjNAj8qjDufArF/1VBiL5ydclh1F
oal5DiGz2UBjZwUepRHf6rkWYUcEqkus/tDB7trFtJmQw7z8yT792II5jez/fBRG
t0ySZFQtW6Rj1hYm9nAKCvBO57TW3g4=
-----END CERTIFICATE-----

And some more bullshit here

-----BEGIN CERTIFICATE-----
MIIGPDCCBCSgAwIBAgIQKJY36ijhHEeh0dETwrX8SjANBgkqhkiG9w0BAQsFADCB
hzELMAkGA1UEBhMCTkwxNzA1BgNVBAoTLk1pbmlzdGVyaWUgdmFuIE9uZGVyd2lq
cyBDdWx0dXVyIGVuIFdldGVuc2NoYXAxPzA9BgNVBAMTNk1pbmlzdGVyaWUgdmFu
IE9uZGVyd2lqcyBDdWx0dXVyIGVuIFdldGVuc2NoYXAgUm9vdCBDQTAeFw0xNTAz
MDMxMDQ5MTVaFw0yNTAzMDMxMDQ5MTVaMIGHMQswCQYDVQQGEwJOTDE3MDUGA1UE
ChMuTWluaXN0ZXJpZSB2YW4gT25kZXJ3aWpzIEN1bHR1dXIgZW4gV2V0ZW5zY2hh
cDE/MD0GA1UEAxM2TWluaXN0ZXJpZSB2YW4gT25kZXJ3aWpzIEN1bHR1dXIgZW4g
V2V0ZW5zY2hhcCBSb290IENBMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKC
AgEAiAlUSbFCISE8rP7mJRA3UDS4xD5rEoi/utrFisexC4k4pyag71cHTQOcPSDL
C73EUbNzejfTv/ycRK4Zexecz0Zcyfhdp+NLjRgUfRi0L6IUVgW3VXxyDWqkz5kx
WysONMSihtkNdH1WqmpS7erW30SXu3wu3grdIBFctagfxSZQU3GcuVY9rwztp2qm
2ju1MGU/+WgjbRATfWswg9uMzYwzY0UC0aElAL81sBywqAlfk8ckp4nM5sERj/c/
CeHoe1i9q/6vl3BOn0oMzrknmC3PRtcQr+mbSSJMRmj2u8O34K91lm5nrRlWg4FK
OdWcywn4PCRf4ljzfBuduuaptqx0Xb80WlV6slUPOhh5Gbq5+8PWIlN9EBLA9gzn
SPfDjrDPHb2HlkZlddzPYwCvtJsWE8uFcrO72CYP7DefL0b0rc1WQesPChYIWBwh
DnXdASq2m0riWstToCS9VlIRi0sPhiYbi3HJLP8P1YvqBcVrPfVV/DN5n9V20aQj
yM1bt74IYVYEjWEwsDRJXPCoNI8hzvdU5XK7C6fVdIdhgetmNN2hMvB8eKzC1pPI
7DR0b0aahZvK2m1f+9918rx+botPDj6hgv/LK33FzvxuRfzHWeCvBwCrOB3zgT++
sXwGCJDbXy9MZPHUXZihuKLwpcavGQ/wfNBicJewcTt9YL0CAwEAAaOBoTCBnjAP
BgNVHRMBAf8EBTADAQH/MDsGA1UdIAQ0MDIwMAYEVR0gADAoMCYGCCsGAQUFBwIB
FhpodHRwOi8vemFrZWxpamsuZHVvLm5sL2NwczAOBgNVHQ8BAf8EBAMCAQYwHQYD
VR0OBBYEFC9SIHSFgYwCrPaRdX0PkJourP24MB8GA1UdIwQYMBaAFC9SIHSFgYwC
rPaRdX0PkJourP24MA0GCSqGSIb3DQEBCwUAA4ICAQARROqiaRYQwJaBUams9eRm
D/TAbCnwrUt1cYuvMBImr2vvjqnNEs75cr4igya9CSKOKaRKN/yIkgXWgw8wgYbk
6CbqnynzIriUn/7/Oz06oVp0KWD+88ocyLmAqHPm/H9pkW9yD3ywQCzD6Z2xTriS
fGm7TReqbzep/EgUrze260uFRs7Dcr1lqQEGEFkw+zFAFfXVXxjCJzSQGiAoKZCO
SYyPIA8c/6vGCgvjt+EYbdbPVL4E8kUkKTU/UOPQjdOo2sEo/+NR9avHwgn0wAaP
fr6wlqvrJnm+V/EsWMXAh2y9fOseInfGSIgYB7QhmjUc0Yd0WeFPs5leGlJZWXj/
/GovNk/C4TqUW28j5iPtJscdfaiL5kpOTU3nvesgmCQL7fh52bkw4Ei5yhtHDmKz
9Bir1/g+QebOl6EgkBy0wnU3m+CNOuMeESb5pM7ZhDkhfSwaCXVT0RGdvTGyeRgZ
Nmv6cTRNcyKtNsq6oApZPKKI9Gse1XvGJDSWId/R/tLZ4IiwhnHk/T4WPN0r5XIu
CIJcb5m+8tpPAxbGfgKkCrdYfeuuXG5PU0rPRgZUgzjQt1+3TaPUlliXTkqYYvGY
NFR25/m1TjQgMesw1lSWBw1U7k+wHFQkaZv/Xjj87d4QXURzbTfWaIERks3r4XnO
jF50oGW5eMwXCCnc59P1lQ==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFyjCCA7KgAwIBAgIEAJiWjDANBgkqhkiG9w0BAQsFADBaMQswCQYDVQQGEwJO
TDEeMBwGA1UECgwVU3RhYXQgZGVyIE5lZGVybGFuZGVuMSswKQYDVQQDDCJTdGFh
dCBkZXIgTmVkZXJsYW5kZW4gUm9vdCBDQSAtIEcyMB4XDTA4MDMyNjExMTgxN1oX
DTIwMDMyNTExMDMxMFowWjELMAkGA1UEBhMCTkwxHjAcBgNVBAoMFVN0YWF0IGRl
ciBOZWRlcmxhbmRlbjErMCkGA1UEAwwiU3RhYXQgZGVyIE5lZGVybGFuZGVuIFJv
b3QgQ0EgLSBHMjCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMVZ5291
qj5LnLW4rJ4L5PnZyqtdj7U5EILXr1HgO+EASGrP2uEGQxGZqhQlEq0i6ABtQ8Sp
uOUfiUtnvWFI7/3S4GCI5bkYYCjDdyutsDeqN95kWSpGV+RLufg3fNU254DBtvPU
Z5uW6M7XxgpT0GtJlvOjCwV3SPcl5XCsMBQgJeN/dVrlSPhOewMHBPqCYYdu8DvE
pMfQ9XQ+pV0aCPKbJdL2rAQmPlU6Yiile7Iwr/g3wtG61jj99O9JMDeZJiFIhQGp
5Rbn3JBV3w/oOM2ZNyFPXfUib2rFEhZgF1XyZWampzCROME4HYYEhLoaJXhena/M
UGDWE4dS7WMfbWV9whUYdMrhfmQpjHLYFhN9C0lK8SgbIHRrxT3dsKpICT0ugpTN
GmXZK4iambwYfp/ufWZ8Pr2UuIHOzZgweMFvZ9C+X+Bo7d7iscksWXiSqt8rYGPy
5V6548r6f1CGPqI0GAwJaCgRHOThuVw+R7oyPxjMW4T182t0xHJ04eOLoEq9jWYv
6q012iDTiIJh8BIitrzQ1aTsr1SIJSQ8p22xcik/Plemf1WvbibG/ufMQFxRRIEK
eN5KzlW/HdXZt1bv8Hb/C3m1r737qWmRRpdogBQ2HbN/uymYNqUg+oJgYjOk7Na6
B6duxc8UpufWkjTYgfX8HV2qXB72o007uPc5AgMBAAGjgZcwgZQwDwYDVR0TAQH/
BAUwAwEB/zBSBgNVHSAESzBJMEcGBFUdIAAwPzA9BggrBgEFBQcCARYxaHR0cDov
L3d3dy5wa2lvdmVyaGVpZC5ubC9wb2xpY2llcy9yb290LXBvbGljeS1HMjAOBgNV
HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFJFoMocVHYnitfGsNig0jQt8YojrMA0GCSqG
SIb3DQEBCwUAA4ICAQCoQUpnKpKBglBu4dfYszk78wIVCVBR7y29JHuIhjv5tLyS
CZa59sCrI2AGeYwRTlHSeYAz+51IvuxBQ4EffkdAHOV6CMqqi3WtFMTC6GY8ggen
5ieCWxjmD27ZUD6KQhgpxrRW/FYQoAUXvQwjf/ST7ZwaUb7dRUG/kSS0H4zpX897
IZmflZ85OkYcbPnNe5yQzSipx6lVu6xiNGI1E0sUOlWDuYaNkqbG9AclVMwWVxJK
gnjIFNkXgiYtXSAfea7+1HAWFpWD2DU5/1JddRwWxRNVz0fMdWVSSt7wsKfkCpYL
+63C4iWEst3kvX5ZbJvw8NjnyvLplzh+ib7M+zkXYT9y2zqR2GUBGR2tUKRXCnxL
vJxxcypFURmFzI79R6d0lR2o0a9OF7FpJsKqeFdbxU2n5Z4FF5TKsl+gSRiNNOkm
bEgeqmiSBeGCc1qb3AdbCG19ndeNIdn8FCCqwkXfP+cAslHkwvgFuXkajDTznlvk
N1trSt8sV4pAWja63XVECDdCcAz+3F4hoKOKwJCcaNpQ5kUQR3i2TtJlycM33+FC
Y7BXN0Ute4qcvwXqZVUz9zkQxSgqIXobisQk+T8VyJoVIPVVYpbtbZNQvOSqeK3Z
ywplh6ZmwcSBo3c6WB4L7oOLnR7SUqTMHW+wmG2UMbX4cQrcufx9MmDm66+KAQ==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFdDCCA1ygAwIBAgIEAJiiOTANBgkqhkiG9w0BAQsFADBaMQswCQYDVQQGEwJO
TDEeMBwGA1UECgwVU3RhYXQgZGVyIE5lZGVybGFuZGVuMSswKQYDVQQDDCJTdGFh
dCBkZXIgTmVkZXJsYW5kZW4gUm9vdCBDQSAtIEczMB4XDTEzMTExNDExMjg0MloX
DTI4MTExMzIzMDAwMFowWjELMAkGA1UEBhMCTkwxHjAcBgNVBAoMFVN0YWF0IGRl
ciBOZWRlcmxhbmRlbjErMCkGA1UEAwwiU3RhYXQgZGVyIE5lZGVybGFuZGVuIFJv
b3QgQ0EgLSBHMzCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAL4yolQP
cPssXFnrbMSkUeiFKrPMSjTysF/zDsccPVMeiAho2G89rcKezIJnByeHaHE6n3WW
IkYFsO2tx1ueKt6c/DrGlaf1F2cY5y9JCAxcz+bMNO14+1Cx3Gsy8KL+tjzk7FqX
xz8ecAgwoNzFs21v0IJyEavSgWhZghe3eJJg+szeP4TrjTgzkApyI/o1zCZxMdFy
KJLZWyNtZrVtB0LrpjPOktvA9mxjeM3KTj215VKb8b475lRgsGYeCasH/lSJEULR
9yS6YHgamPfJEf0WwTUaVHXvQ9Plrk7O53vDxk5hUUurmkVLoR9BvUhTFXFkC4az
5S6+zqQbwSmEorXLCCN2QyIkHxcE1G6cxvx/K2Ya7Irl1s9N9WMJtxU51nus6+N8
6U78dULI7ViVDAZCopz35HCz33JvWjdAidiFpNfxC95DGdRKWCyMijmev4SH8RY7
Ngzp07TKbBlBUgmhHbBqv4LvcFEhMtwFdozL92TkA1CvjJFnq8Xy7ljY3r735zHP
bMk7ccHViLVlvMDoFxcHErVc0qsgk7TmgoNwNsXNo42ti+yjwUOH5kPiNL6VizXt
BznaqB16nzaeErAMZRKQFWDZJkBE41ZgpRDUajz9QdwOWke275dhdU/Z/seyHdTt
XUmzqWrLZoQT1Vyg3N9udwbRcXXIV2+vD3dbAgMBAAGjQjBAMA8GA1UdEwEB/wQF
MAMBAf8wDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBRUrfrHkleuyjWcLhL75Lpd
INyUVzANBgkqhkiG9w0BAQsFAAOCAgEAMJmdBTLIXg47mAE6iqTnB/d6+Oea31BD
U5cqPco8R5gu4RV78ZLzYdqQJRZlwJ9UXQ4DO1t3ApyEtg2YXzTdO2PCwyiBwpwp
LiniyMMB8jPqKqrMCQj3ZWfGzd/TtiunvczRDnBfuCPRy5FOCvTIeuXZYzbB1N/8
Ipf3YF3qKS9Ysr1YvY2WTxB1v0h7PVGHoTx0IsL8B3+A3MSs/mrBcDCw6Y5p4ixp
gZQJut3+TcCDjJRYwEYgr5wfAvg1VUkvRtTA8KCWAg8zxXHzniN9lLf9OtMJgwYh
/WA9rjLA0u6NpvDntIJ8CsxwyXmA+P5M9zWEGYox+wrZ13+b8KKaa8MFSu1BYBQw
0aoRQm7TIwIEC8Zl3d1Sd9qBa7Ko+gE4uZbqKmxnl4mUnrzhVNXkanjvSr0rmj1A
fsbAddJu+2gw7OyLnflJNZoaLNmzlTnVHpL3prllL+U9bTpITAjc5CgSKL59NVzq
4BZ+Extq1z7XnvwtdbLBFNUjA9tbbws+eC8N3jONFrdI54OagQ97wUNNVQQXOEpR
1VmiiXTTn74eS9fGbbeIJG9gkaSChVtWQbzQRKtqE77RLFi3EjNYsjdj3BP1lB0/
QFH1T/U67cjF68IeHRaVesd+QnGTbksVtzDfqu1XhUisHWrdOWnk4Xl4vs4Fv6EM
94B7IWcnMFk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGnTCCBIWgAwIBAgIRAJWCkb3C6S/P8J7zgXwQTRcwDQYJKoZIhvcNAQELBQAw
gYcxCzAJBgNVBAYTAk5MMTcwNQYDVQQKEy5NaW5pc3RlcmllIHZhbiBPbmRlcndp
anMgQ3VsdHV1ciBlbiBXZXRlbnNjaGFwMT8wPQYDVQQDEzZNaW5pc3RlcmllIHZh
biBPbmRlcndpanMgQ3VsdHV1ciBlbiBXZXRlbnNjaGFwIFJvb3QgQ0EwHhcNMTUx
MTIzMDk1OTE5WhcNMjUxMTIyMDk0OTE5WjCBhTELMAkGA1UEBhMCTkwxNzA1BgNV
BAoTLk1pbmlzdGVyaWUgdmFuIE9uZGVyd2lqcyBDdWx0dXVyIGVuIFdldGVuc2No
YXAxPTA7BgNVBAMTNE1pbmlzdGVyaWUgdmFuIE9DVyBEaWdpdGFhbCBPbmRlcndp
anMgQ2VydGlmaWNhYXQgQ0EwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoIC
AQCdGXHbhyCom0FjVPVDBCXVIXhOmaJCCrDhH/hnZJXdZyzXz9VrfCFXkaNBaK1l
9j/hNunThoFax5cReMiwn3yaN2yVYbGpbAAp6pbgU7nsTkkz+drer910YJpzL6eP
JLOYa/hv92h3knrS/76I6aWBHEsfkwDP8x5AY4vMgzEgVG5URUCcw2hw4I0B2d5Q
pZu2wdTutxiUPeTuCsmJbU0aBT6cau7nz87MJPpOi9xuiMPZt4C4pGnd1c99rai3
m6Q1d6n0bIZY8yJijWsvVGo9S3T2efTKFKpnwSimbAL5i6WEVtff2SQANPeRaNyB
Xd64Z0xlcCWcKrc1ipADYZFLUOE9uIQdcnlbx7OJHYA+SxKkgS35DCiCa2TgZcl2
13NvB7v90mkFcUOB8HXbE08NatylyiiHEFZ0kAMklfifwPlsu2JYO7ujTaLW2El2
FE62onX1hjb1zqAUFcWnSEBgsZx6LxuaNi675dy87GOhqDcs+T4NZ/oOsk5+D27C
UYk+nZpdzHWUUJBeN0PnJKVt5q+U3Wk53OCUWyOvPQxS460zDyxwPlMCd7BGLyFR
Hco6UAZi95SmzdZP2kqvrwWPWfk83p8spA6Nf20/+ieeOHMKH/Fq3gbnxnt9bLJf
FZHq/UdTeSLL/EP+7Qigtii9amI7WY7CLEAsuF3lppDQOQIDAQABo4IBAjCB/zAO
BgNVHQ8BAf8EBAMCAQYwHwYDVR0jBBgwFoAUL1IgdIWBjAKs9pF1fQ+Qmi6s/bgw
DwYDVR0TAQH/BAUwAwEB/zA7BgNVHSAENDAyMDAGBFUdIAAwKDAmBggrBgEFBQcC
ARYaaHR0cDovL3pha2VsaWprLmR1by5ubC9jcHMwHQYDVR0OBBYEFK6dZ4nqW+Ia
EbiyHFY/LBrgFxZcMF8GA1UdHwRYMFYwVKBSoFCGTmh0dHA6Ly96YWtlbGlqay5k
dW8ubmwvY3JsL01pbmlzdGVyaWV2YW5PbmRlcndpanNDdWx0dXVyZW5XZXRlbnNj
aGFwUm9vdENBLmNybDANBgkqhkiG9w0BAQsFAAOCAgEANRODNMzxm4qpYp3jMncq
+rlHhKE49J+HPM2Zk2oFZX/aYrxCvbSOQi3kFUbYm7JuPSaHNKM4DpTT4B3kGDaO
Id3fs6oi4785Jd5MdUVRrikdh0343MNMGnwmj52GR7d0uaGjZ9hRnkpo2la3LZiy
eOrNhGbBJYaUEb6r34rO77H3Uv6Q0aYjmAMgElOJiWDGIfXHV9LQaVXr+kNnSOuA
K2AluFkT9NHz9zwh8Zlw49il3zdhHdrwVBOxJrqgImdtxWE58+0Jdg0za164IeFF
2Xwu941EXwZKM+iuVncH1UzfxfQqrf0KM7glnLs84/esEbhLu643pPHR8UefhXSp
Lntnsh/5tARtP96ALJxosQHqow5etE83SFtjo/CkhFTmxzyzrZ/hZh01SlnK4GvE
LHARANf0gQG9CpvgXD8OT3n2GldZn2RHO11wlXpErA/l7+J/qPp5de0r0HMqA4Pr
uTGiVP9o54CIYMxs8e0N5mK58VLkqhM0QliMEmZEkoXYhM5iJzRrB+pyyTpBwQ2L
tI3+BIW/QhPTsTOxtTRexq7TPqOswP+iPInAL957GVlgVVedNf6EhtW8n68LwFar
Eyn741IZhBSud7yvNumVY3L6YunO5rkP8nRjv2Kk8BBg93VWr4aXzFqH0q0DzPtV
hL/ZOkNhkJQIMVnIInVqeWg=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGPDCCBCSgAwIBAgIQKJY36ijhHEeh0dETwrX8SjANBgkqhkiG9w0BAQsFADCB
hzELMAkGA1UEBhMCTkwxNzA1BgNVBAoTLk1pbmlzdGVyaWUgdmFuIE9uZGVyd2lq
cyBDdWx0dXVyIGVuIFdldGVuc2NoYXAxPzA9BgNVBAMTNk1pbmlzdGVyaWUgdmFu
IE9uZGVyd2lqcyBDdWx0dXVyIGVuIFdldGVuc2NoYXAgUm9vdCBDQTAeFw0xNTAz
MDMxMDQ5MTVaFw0yNTAzMDMxMDQ5MTVaMIGHMQswCQYDVQQGEwJOTDE3MDUGA1UE
ChMuTWluaXN0ZXJpZSB2YW4gT25kZXJ3aWpzIEN1bHR1dXIgZW4gV2V0ZW5zY2hh
cDE/MD0GA1UEAxM2TWluaXN0ZXJpZSB2YW4gT25kZXJ3aWpzIEN1bHR1dXIgZW4g
V2V0ZW5zY2hhcCBSb290IENBMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKC
AgEAiAlUSbFCISE8rP7mJRA3UDS4xD5rEoi/utrFisexC4k4pyag71cHTQOcPSDL
C73EUbNzejfTv/ycRK4Zexecz0Zcyfhdp+NLjRgUfRi0L6IUVgW3VXxyDWqkz5kx
WysONMSihtkNdH1WqmpS7erW30SXu3wu3grdIBFctagfxSZQU3GcuVY9rwztp2qm
2ju1MGU/+WgjbRATfWswg9uMzYwzY0UC0aElAL81sBywqAlfk8ckp4nM5sERj/c/
CeHoe1i9q/6vl3BOn0oMzrknmC3PRtcQr+mbSSJMRmj2u8O34K91lm5nrRlWg4FK
OdWcywn4PCRf4ljzfBuduuaptqx0Xb80WlV6slUPOhh5Gbq5+8PWIlN9EBLA9gzn
SPfDjrDPHb2HlkZlddzPYwCvtJsWE8uFcrO72CYP7DefL0b0rc1WQesPChYIWBwh
DnXdASq2m0riWstToCS9VlIRi0sPhiYbi3HJLP8P1YvqBcVrPfVV/DN5n9V20aQj
yM1bt74IYVYEjWEwsDRJXPCoNI8hzvdU5XK7C6fVdIdhgetmNN2hMvB8eKzC1pPI
7DR0b0aahZvK2m1f+9918rx+botPDj6hgv/LK33FzvxuRfzHWeCvBwCrOB3zgT++
sXwGCJDbXy9MZPHUXZihuKLwpcavGQ/wfNBicJewcTt9YL0CAwEAAaOBoTCBnjAP
BgNVHRMBAf8EBTADAQH/MDsGA1UdIAQ0MDIwMAYEVR0gADAoMCYGCCsGAQUFBwIB
FhpodHRwOi8vemFrZWxpamsuZHVvLm5sL2NwczAOBgNVHQ8BAf8EBAMCAQYwHQYD
VR0OBBYEFC9SIHSFgYwCrPaRdX0PkJourP24MB8GA1UdIwQYMBaAFC9SIHSFgYwC
rPaRdX0PkJourP24MA0GCSqGSIb3DQEBCwUAA4ICAQARROqiaRYQwJaBUams9eRm
D/TAbCnwrUt1cYuvMBImr2vvjqnNEs75cr4igya9CSKOKaRKN/yIkgXWgw8wgYbk
6CbqnynzIriUn/7/Oz06oVp0KWD+88ocyLmAqHPm/H9pkW9yD3ywQCzD6Z2xTriS
fGm7TReqbzep/EgUrze260uFRs7Dcr1lqQEGEFkw+zFAFfXVXxjCJzSQGiAoKZCO
SYyPIA8c/6vGCgvjt+EYbdbPVL4E8kUkKTU/UOPQjdOo2sEo/+NR9avHwgn0wAaP
fr6wlqvrJnm+V/EsWMXAh2y9fOseInfGSIgYB7QhmjUc0Yd0WeFPs5leGlJZWXj/
/GovNk/C4TqUW28j5iPtJscdfaiL5kpOTU3nvesgmCQL7fh52bkw4Ei5yhtHDmKz
9Bir1/g+QebOl6EgkBy0wnU3m+CNOuMeESb5pM7ZhDkhfSwaCXVT0RGdvTGyeRgZ
Nmv6cTRNcyKtNsq6oApZPKKI9Gse1XvGJDSWId/R/tLZ4IiwhnHk/T4WPN0r5XIu
CIJcb5m+8tpPAxbGfgKkCrdYfeuuXG5PU0rPRgZUgzjQt1+3TaPUlliXTkqYYvGY
NFR25/m1TjQgMesw1lSWBw1U7k+wHFQkaZv/Xjj87d4QXURzbTfWaIERks3r4XnO
jF50oGW5eMwXCCnc59P1lQ==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGBDCCA+ygAwIBAgIJANIncLtaUQGfMA0GCSqGSIb3DQEBCwUAMIGOMQswCQYD
VQQGEwJOTDEVMBMGA1UECAwMWnVpZC1Ib2xsYW5kMRwwGgYDVQQKDBNTdGljaHRp
bmcgS2VubmlzbmV0MSUwIwYDVQQDDBxFZHVrb3BwZWxpbmcgRkFLRSByb290IENB
IEczMSMwIQYJKoZIhvcNAQkBFhRzdXBwb3J0QGtlbm5pc25ldC5ubDAeFw0xNTEy
MDIxNDQ3MDdaFw0yNTExMjkxNDQ3MDdaMIGOMQswCQYDVQQGEwJOTDEVMBMGA1UE
CAwMWnVpZC1Ib2xsYW5kMRwwGgYDVQQKDBNTdGljaHRpbmcgS2VubmlzbmV0MSUw
IwYDVQQDDBxFZHVrb3BwZWxpbmcgRkFLRSByb290IENBIEczMSMwIQYJKoZIhvcN
AQkBFhRzdXBwb3J0QGtlbm5pc25ldC5ubDCCAiIwDQYJKoZIhvcNAQEBBQADggIP
ADCCAgoCggIBANDFszUkK1WFqPt/cBjOhzPCuaZHoX0bC818ZetDKJWl3ibLD6DL
n7JxQMQgC4IAwbU6tJKPq8lcBLOxbbYRdlnc7T4XQh5Offt5Ew5RBkrmjk5C8U4A
FXeDdEN2SjnaWaGopYJkx1Vh5dAd5r4agktA5BKsTcKNDv7pQYh6UxlLJSwaFBU2
qY9t8Vc6i5GfiDW01W7vtkdKl2wm3HYdmbD1xHZbpe6Bg5BNDOOP8QGhre6TO7R0
gonCsu55W+G6WKQnCCLY+rS+2vbai5/YGuK5lMtS2Ji5oRwEQArKNGBX0PYNarCW
NdiZsgWTgdTIsyoVpHsTl4HeEjnhLHdGI380zRYpIzVQ8sDVkIXqd2mjXoE7WUzR
85qNGann+zH5HBwhzluenN+aBtqsjef71Q/FptqeMtdG0uCcnGVEHrpybrIdB1Xc
rus97hQgNnwdzQBpcx9CQkreR0TwOJEVwDG2jMLo4TGpYL8qvr/c8zuM5mvgjWaZ
cv7Y91p8llaYqSDh3SDybSsrA4yr3PyEJySqivq2ESWWDXKllKWvrnzKKN6J/tr1
ernXaePH/jEJe3NHgsGKODBKSXfSpT1/Gq5ToEPzlVYy6IP1heXNOTNV2V70DzZI
oBXPbceVAT8hQG5PYYk8nOdbZSYcy/sKspId3YZiSU1YwX1ZGESjBsi9AgMBAAGj
YzBhMB0GA1UdDgQWBBSM+MO0Dl34bZWdH2Elp59xUfYe3DAfBgNVHSMEGDAWgBSM
+MO0Dl34bZWdH2Elp59xUfYe3DAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQE
AwIBhjANBgkqhkiG9w0BAQsFAAOCAgEAZwEsKFYvD3SMwjYoiOqHCwRDwIK76K+z
nuSPpS98AWcFFMDnTg5sVL8gFdBDOaqKHQ/Q6ZKjdIMXOzJFgH99NS9BBh2Xl96Z
3BTyXk53hZDPud/l7kZNWn1TU4fPmANUtT+MyALVLaWgkWJNMfO16UUmawnKiRM6
p0K36iopbI3+Yu1Au4Lkemx87c7gU7tqjrPagMN3/QKAVU1wJ8OVGsSinFVIAvTo
LwDLa1jmUpsmGwdoUHeDdT1jQNnmPz2hrSJVGrNWs4iqxH59v6cn82MO25t7aX8J
qtpBeYg4rAuopTELENvu+EIpXjv1XS2rn/DP758Kzac9K/jOQ7B9i7Jh+wVLLKmB
u6bOs4bSiePaEYEU7rOIT6Or4Z+Z2QqgLnniH+E2Qs07Uz7PzSq/n1ciLTTr7YYF
XLcwiAjL6lPwhh5LGKxjxUrpLpIYVZhPDa6Gg9xCVWdLu3ZRgnH0xzu7Cid5Vndp
riwngKSpEHcScbLloP5lq7bWl7mjEjC8F5wPSgTfyfK/8nO4gyJcDX+eYJOeYgDQ
mDh7Dxv2BBbiTKmHNBhzKkPSz9QZqjwg8PzS4bctRxi8JZO5xhZZT8oFrrut2lHe
bpdhUeWXA+IFxocXyDdi/MG8fo7h0rpoXqgD5sWqqhFjVa19ShZ/nEhGY19aZVlO
DgNDzSbMmzI=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFhDCCA2ygAwIBAgIEAJimITANBgkqhkiG9w0BAQsFADBiMQswCQYDVQQGEwJO
TDEeMBwGA1UECgwVU3RhYXQgZGVyIE5lZGVybGFuZGVuMTMwMQYDVQQDDCpTdGFh
dCBkZXIgTmVkZXJsYW5kZW4gUHJpdmF0ZSBSb290IENBIC0gRzEwHhcNMTMxMTE0
MTM0ODU1WhcNMjgxMTEzMjMwMDAwWjBiMQswCQYDVQQGEwJOTDEeMBwGA1UECgwV
U3RhYXQgZGVyIE5lZGVybGFuZGVuMTMwMQYDVQQDDCpTdGFhdCBkZXIgTmVkZXJs
YW5kZW4gUHJpdmF0ZSBSb290IENBIC0gRzEwggIiMA0GCSqGSIb3DQEBAQUAA4IC
DwAwggIKAoICAQDaIMh56ynwnEhE7Ey54KpX5j1XDoxbHDCgXctute55RjmG2hy6
fuq++q/dCSsj38Pi/KYn/PN13EF05k39IRvakb0AQNVyHifNKXfta6Tzi5QcM4BK
09DB4Ckb6TdZTNUtWyEcAtRblYaVSQ4Xr5QODNqu2FGQucraVXqCIx81azlOE2Jb
Zli9AZKn94pP57A11dUYhxMsh70YosJEKVB8Ue4ROksHhb/nnOISG+2y9FD5M8u8
jYhp00TGZGVu5z0IFgtqX0i8GmrH0ub9AWjf/iU4MWjGVRSq0cwUHEeKRj/UD9a8
xIEn9TxIfYj+6+s4tn9dW/4PV5jc6iGJx6ExTPfOR7VHpxS4XujrZb5Ba/+oj/ON
dOfR0JSm2itCytbtjQBBL0oocIIqaqOna1cufHkcn9VleF7Zvz/8njQIpAU4J4nJ
4pE5pQ3k4ORAGNnq5R9hAqqUQGDlo3Uj8PBou0nPzQ7JNgGkN+my/lGr4rceUNK/
8CoGnYFUH+UyFtJkvlLlEkb688/IdNdGgY+vuXCAB6xfKlJjAGChFUBb6swbNeNc
tVEdUj7Weg4Jt5gXu78C2mjs9x5lcHOgMO4ZmvYJ3Ejp4k3nNa45HOIVkYrfQrrB
HzBhR0BuReAagurcbtUjJFd7BtufGVLfU3CUn1l6u3/9eG4DGH6pq+dSKQIDAQAB
o0IwQDAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAdBgNVHQ4EFgQU
Kv25Kx76w4SHBtuB/4aXdQ3rAYswDQYJKoZIhvcNAQELBQADggIBAEvpmXMOOKdQ
wUPysrsdIkGJUFF+dvmsJDiOuAqV0A1nNTooL3esvDLEZAWZwKTOwRomnHzeCfS/
QxRKTkVX21pfrHf9ufDKykpzjl9uAILTS76FJ6//R0RTIPMrzknQpG2fCLR5DFEb
HWU/jWAxGmncfx6HQYl/azHaWbv0dhZOUjPdkGAQ6EPvHcyNU9yMkETdw0X6ioxq
zMwkGM893oBrMmtduiqIf3/H6HTXoRKAc+/DXZIq/pAc6eVMa6x43kokluaam9L7
8yDrlHbGd2VYAr/HZ0TjDZTtI2t2/ySTb7JjC8wL8rSqxYmLpNrnhZzPW87sl2OC
FC3re3ZhtJkIHNP85jj1gqewTC7DCW6llZdB3hBzfHWby0EX2RlcwgaMfNBEV5U0
IogccdXV+S6zWK4F+yBr0sXUrdbdMFu+g3I9CbXxt0q4eVJtoaun4M2Z+bZMqZvy
9FryBdSfhpgmJqwFz2luOhPOVCblCPhLrUeewrvuBXoZQWt1ZjuHfwJZ1dgjszVE
qwY9S0SdqCg2ZlL9s3vDIrrd3wLWrcHLQMd9gwsppNv9c7JfIJdlcZLTmF9EuL6e
CvVVrqBVqLHjva4erqYol6K/jbSfUtRCy8IlFU7LYu1KLehZKYvj3vekj3Cn08Aq
ljr/Q8Pw+OfUZTzKg4PVDQVfFqKtyosv
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
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
-----END CERTIFICATE-----

`

func CertificateCheck(responseWriter http.ResponseWriter, request *http.Request) {
	log.Printf("START at " + strconv.Itoa(int(time.Now().UnixNano())))

	// TODO read certificate, truststore and reference time from the request
	certificate, err := helpers.ReadCertificateFromRequest(request)
	if err != nil {
		writeResponse(400, err.Error(), responseWriter)
		return
	}

	verifyCertificateChainChannel := make(chan string)
	defer close(verifyCertificateChainChannel)
	buildTrustChainChannel := make(chan []*x509.Certificate)
	defer close(buildTrustChainChannel)

	go helpers.BuildTrustChain(buildTrustChainChannel, certificate)
	trustChain := <-buildTrustChainChannel
	if len(trustChain) == 1 {
		log.Printf("No parent certificate found. So this is the root certificate. ")
	}

	go helpers.VerifyTrustChain(
		verifyCertificateChainChannel,
		trustChain,
		[]byte(trustStore),
		//time.Date(2020, time.February, 22, 13, 50, 0, 0, time.UTC),
		time.Now(),
	)
	certificateChainErrorMessage := <-verifyCertificateChainChannel
	if certificateChainErrorMessage != "" {
		log.Printf("ABORT Certificate not valid!")
		log.Printf("END at " + strconv.Itoa(int(time.Now().UnixNano())))
		writeResponse(400, certificateChainErrorMessage, responseWriter)
		return
	}

	log.Printf("END at " + strconv.Itoa(int(time.Now().UnixNano())))
	fmt.Fprintf(responseWriter, "Certificate OK ")
}

func writeResponse(statusCode int, message string, responseWriter http.ResponseWriter) {
	responseWriter.WriteHeader(statusCode)
	fmt.Fprintf(responseWriter, message)
}
